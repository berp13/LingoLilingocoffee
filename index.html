<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Talk English</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            background-color: #F8F4E3;
            color: #3C2F2F;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background-color: #FFFFFF;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .section-title {
            color: #6C4A4A;
        }
        .btn-primary {
            background-color: #D2B48C;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #A68C6A;
        }
        .phrase-card, .quiz-box, .reward-box {
            border: 1px solid #E0E0E0;
            border-radius: 0.5rem;
        }
        .option {
            transition: background-color 0.2s, transform 0.2s;
        }
        .option:hover {
            background-color: #E0E0E0;
            transform: translateY(-2px);
        }
        .option.correct {
            background-color: #A9D1A9;
            color: white;
        }
        .option.wrong {
            background-color: #E8A8A8;
            color: white;
        }
        .audio-icon {
            cursor: pointer;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .reward-box img {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body class="p-4">

    <!-- Audio de fondo -->
    <audio id="background-audio" loop muted>
        <source src="coffee_song.mp3" type="audio/mpeg">
    </audio>

    <div class="container mx-auto p-6 md:p-10 rounded-xl shadow-lg mt-8 bg-white">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold section-title mb-2">Â¡Hola, Barista BilingÃ¼e! â˜•</h1>
            <p class="text-lg md:text-xl text-gray-600">Aprende inglÃ©s para tu cafeterÃ­a, Â¡gana recompensas y diviÃ©rtete!</p>
        </header>

        <!-- SecciÃ³n de progreso de nivel -->
        <section class="mb-8">
            <div class="flex justify-between items-center mb-2">
                <span id="level-title" class="text-lg font-bold text-gray-700"></span>
                <span id="quiz-progress" class="text-sm text-gray-500"></span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="progress-bar" class="bg-yellow-500 h-4 rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
            </div>
        </section>

        <!-- SecciÃ³n de contenido principal: Palabras, Quiz y Recompensas -->
        <section id="content-container" class="space-y-8">
            <!-- El contenido dinÃ¡mico se carga aquÃ­ -->
        </section>
    </div>

    <script>
        const contentContainer = document.getElementById('content-container');
        const levelTitleEl = document.getElementById('level-title');
        const quizProgressEl = document.getElementById('quiz-progress');
        const progressBarEl = document.getElementById('progress-bar');
        
        let currentLevel = 0;
        let score = 0;

        // Base de datos de palabras y preguntas
        const ALL_WORDS = [
            { es: "Hola", en: "Hello" }, { es: "Gracias", en: "Thank you" }, { es: "Por favor", en: "Please" },
            { es: "CafÃ©", en: "Coffee" }, { es: "TÃ©", en: "Tea" }, { es: "Agua", en: "Water" },
            { es: "Panecillo", en: "Muffin" }, { es: "SÃ¡ndwich", en: "Sandwich" }, { es: "Croissant", en: "Croissant" },
            { es: "Leche", en: "Milk" }, { es: "AzÃºcar", en: "Sugar" }, { es: "Hielo", en: "Ice" },
            { es: "Taza", en: "Cup" }, { es: "Vaso", en: "Glass" }, { es: "Cuchara", en: "Spoon" },
            { es: "Para aquÃ­", en: "For here" }, { es: "Para llevar", en: "To go" }, { es: "Cuchillo", en: "Knife" },
            { es: "Tenedor", en: "Fork" }, { es: "Servilleta", en: "Napkin" }, { es: "Cuenta", en: "Bill" },
            { es: "Pastel", en: "Cake" }, { es: "Pan", en: "Bread" }, { es: "Galleta", en: "Cookie" },
            { es: "Jugo", en: "Juice" }, { es: "Con", en: "With" }, { es: "Sin", en: "Without" },
            { es: "Â¿Algo mÃ¡s?", en: "Anything else?" }, { es: "Total", en: "Total" }, { es: "Tarjeta", en: "Card" },
            { es: "Â¿QuÃ© desea?", en: "What would you like?" }, { es: "Caliente", en: "Hot" }, { es: "FrÃ­o", en: "Cold" },
            { es: "Mesa", en: "Table" }, { es: "Silla", en: "Chair" }, { es: "Abierto", en: "Open" },
            { es: "Cerrado", en: "Closed" }, { es: "Listo", en: "Ready" }, { es: "AquÃ­", en: "Here" },
            { es: "AllÃ¡", en: "There" }
        ];

        const ALL_QUESTIONS = [
            { q: 'Â¿CÃ³mo se dice "Gracias" en inglÃ©s?', options: ['Sorry', 'Please', 'Thank you'], a: 2 },
            { q: 'Si un cliente dice "Hello!", Â¿quÃ© le respondes?', options: ['Goodbye!', 'Welcome!', 'Thank you!'], a: 1 },
            { q: 'Para pedir un "muffin", se dice:', options: ['A pastry', 'A muffin', 'A cake'], a: 1 },
            { q: 'Â¿CÃ³mo se dice "Para llevar" en inglÃ©s?', options: ['To go', 'For home', 'For now'], a: 0 },
            { q: 'Si te piden "a small coffee", Â¿quÃ© significa?', options: ['Un cafÃ© pequeÃ±o', 'Un cafÃ© dulce', 'Un cafÃ© grande'], a: 0 },
            { q: 'Si el cliente dice "Good morning!", Â¿a quÃ© hora llega?', options: ['En la tarde', 'En la noche', 'En la maÃ±ana'], a: 2 },
            { q: 'Un cliente pide "A cookie". Â¿QuÃ© quiere?', options: ['Un pan', 'Una galleta', 'Un pastel'], a: 1 },
            { q: 'Para preguntar si el cliente quiere algo mÃ¡s, dices:', options: ['What is more?', 'Anything else?', 'More?'], a: 1 },
            { q: 'Â¿CÃ³mo se dice "Con azÃºcar" en inglÃ©s?', options: ['With sugar', 'Without sugar', 'Sugar with'], a: 0 },
            { q: 'Si te piden "an iced coffee", Â¿quÃ© significa?', options: ['Un cafÃ© con hielo', 'Un cafÃ© caliente', 'Un cafÃ© sin leche'], a: 0 },
            { q: 'Un cliente te pide un "spoon". Â¿QuÃ© le das?', options: ['Un tenedor', 'Un cuchillo', 'Una cuchara'], a: 2 },
            { q: 'Si el letrero de la cafeterÃ­a dice "Closed", Â¿quÃ© significa?', options: ['Abierto', 'Cerrado', 'Ocupado'], a: 1 }
        ];

        const REWARDS = ["un cafÃ© gratis", "una gorra de la cafeterÃ­a", "media hora de descanso", "el cafÃ© de la casa"];
        
        // --- Generar todos los niveles y quizzes ---
        const QUIZZES = [];
        for (let i = 0; i < 30; i++) {
            const shuffledWords = [...ALL_WORDS].sort(() => 0.5 - Math.random()).slice(0, 10);
            const shuffledQuestions = [...ALL_QUESTIONS].sort(() => 0.5 - Math.random()).slice(0, 12);
            QUIZZES.push({
                name: `Nivel ${i + 1}`,
                words: shuffledWords,
                questions: shuffledQuestions
            });
        }

        // Funciones de audio
        const synth = window.speechSynthesis;
        function speak(text) {
            if (synth.speaking) {
                console.error('speechSynthesis.speaking');
                return;
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            synth.speak(utterance);
        }

        // --- Manejo del flujo de juego ---
        function renderContent() {
            if (currentLevel >= QUIZZES.length) {
                showFinalMessage();
                return;
            }
            const currentQuizData = QUIZZES[currentLevel];
            
            levelTitleEl.textContent = currentQuizData.name;
            quizProgressEl.textContent = `Nivel ${currentLevel + 1} de ${QUIZZES.length}`;
            const progressPercentage = ((currentLevel + 1) / QUIZZES.length) * 100;
            progressBarEl.style.width = `${progressPercentage}%`;

            renderWords(currentQuizData.words);
        }

        function renderWords(words) {
            const wordCards = words.map(p => `
                <div class="bg-gray-100 p-4 rounded-lg flex flex-col items-center">
                    <span class="text-xs text-gray-500">${p.es}</span>
                    <span class="text-xl font-bold mt-1">${p.en}</span>
                    <div class="mt-2 text-xl audio-icon" onclick="speak('${p.en}')">ðŸ”Š</div>
                </div>
            `).join('');
            
            contentContainer.innerHTML = `
                <h2 class="text-2xl font-bold section-title text-center mb-4">LecciÃ³n de Vocabulario</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    ${wordCards}
                </div>
                <div class="text-center mt-6">
                    <button onclick="showQuiz()" class="btn-primary py-3 px-8 text-white rounded-full font-bold">Â¡Estoy lista para el quiz!</button>
                </div>
            `;
        }

        function showQuiz() {
            const quizData = QUIZZES[currentLevel];
            const optionsHtml = quizData.questions.map((q, qIndex) => `
                <div class="mb-6">
                    <p class="text-lg font-semibold mb-2">${qIndex + 1}. ${q.q}</p>
                    <div id="q-${qIndex}" class="grid grid-cols-1 md:grid-cols-3 gap-2">
                        ${q.options.map((o, oIndex) => `
                            <div class="option p-3 rounded-lg text-center cursor-pointer bg-gray-100" data-q-index="${qIndex}" data-o-index="${oIndex}">
                                ${o}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            contentContainer.innerHTML = `
                <h2 class="text-2xl font-bold section-title text-center mb-4">Â¡Es Hora del Quiz!</h2>
                ${optionsHtml}
                <div id="quiz-feedback" class="text-center text-lg mt-4 font-bold"></div>
                <div class="text-center mt-6 hidden" id="next-level-btn-container">
                    <button onclick="moveToNextLevel()" class="btn-primary py-3 px-8 text-white rounded-full font-bold">Siguiente Nivel</button>
                </div>
            `;
            
            // Asignar los eventos de clic a las opciones
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', () => {
                    checkAnswer(option);
                });
            });
        }

        function checkAnswer(element) {
            const questionIndex = parseInt(element.dataset.qIndex);
            const selectedOptionIndex = parseInt(element.dataset.o-index);
            const quizData = QUIZZES[currentLevel];
            const correctOptionIndex = quizData.questions[questionIndex].a;
            
            const optionsContainer = document.getElementById(`q-${questionIndex}`);
            const options = optionsContainer.querySelectorAll('.option');
            options.forEach(opt => opt.style.pointerEvents = 'none'); // Deshabilitar clics

            if (selectedOptionIndex === correctOptionIndex) {
                element.classList.add('correct');
                score++;
            } else {
                element.classList.add('wrong');
                options[correctOptionIndex].classList.add('correct');
            }

            // Verificar si todas las preguntas han sido respondidas
            const allAnswered = Array.from(document.querySelectorAll('.option')).every(opt => opt.classList.contains('correct') || opt.classList.contains('wrong'));
            
            if (allAnswered) {
                setTimeout(() => {
                    document.getElementById('quiz-feedback').innerHTML = `<span class="text-green-600">Â¡Quiz completado!</span>`;
                    document.getElementById('next-level-btn-container').classList.remove('hidden');
                }, 1000);
            }
        }

        window.moveToNextLevel = () => {
            showReward();
        };

        function showReward() {
            const rewardIndex = currentLevel % REWARDS.length;
            const reward = REWARDS[rewardIndex];
            contentContainer.innerHTML = `
                <div class="reward-box text-center p-6 bg-white rounded-lg shadow-inner">
                    <h2 class="text-3xl font-bold section-title mb-4">Â¡Nivel Completado! ðŸŽ‰</h2>
                    <p class="text-xl">Â¡Felicidades, Barista BilingÃ¼e! Te has ganado</p>
                    <div class="flex flex-col items-center justify-center my-6">
                        <img src="https://placehold.co/100x100/A68C6A/FFFFFF?text=âœ¨" alt="Reward Icon" class="w-24 h-24">
                        <span class="mt-4 text-2xl font-extrabold text-yellow-600 uppercase">${reward}</span>
                    </div>
                    <p class="text-sm italic text-gray-500">Â¡Habla con tu hijo/a para reclamar tu recompensa!</p>
                    <button onclick="startNextQuiz()" class="btn-primary py-3 px-8 text-white rounded-full font-bold mt-6">Continuar</button>
                </div>
            `;
        }

        window.startNextQuiz = () => {
            currentLevel++;
            renderContent();
        };

        function showFinalMessage() {
            contentContainer.innerHTML = `
                <div class="text-center p-6 bg-white rounded-lg shadow-inner">
                    <h2 class="text-3xl font-bold section-title mb-4">Â¡Has completado todos los niveles! ðŸŽ‰</h2>
                    <p class="text-xl">Â¡Felicidades, Barista BilingÃ¼e! Ya eres una experta.</p>
                </div>
            `;
            levelTitleEl.textContent = "Â¡Aventura Terminada!";
            quizProgressEl.textContent = "30 de 30";
            progressBarEl.style.width = "100%";
        }
        
        // Activar audio y renderizar la pÃ¡gina al cargar
        document.body.addEventListener('click', function() {
            const audio = document.getElementById('background-audio');
            if (audio.muted) {
                audio.muted = false;
                audio.play();
            }
        }, { once: true });
        
        window.onload = () => {
            renderContent();
        };
    </script>
</body>
</html>
